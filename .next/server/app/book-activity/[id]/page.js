(()=>{var e={};e.id=2854,e.ids=[2854],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6113:e=>{"use strict";e.exports=require("crypto")},9523:e=>{"use strict";e.exports=require("dns")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},85158:e=>{"use strict";e.exports=require("http2")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},80639:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>_,pages:()=>d,routeModule:()=>y,tree:()=>c});var a=i(50482),o=i(69108),r=i(62563),n=i.n(r),s=i(68300),l={};for(let e in s)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>s[e]);i.d(t,l);let c=["",{children:["book-activity",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(i.bind(i,29127)),"/Users/shreyasgurav/Documents/Projects/Zest Deployed/src/app/book-activity/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(i.bind(i,39258)),"/Users/shreyasgurav/Documents/Projects/Zest Deployed/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(i.t.bind(i,69361,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/shreyasgurav/Documents/Projects/Zest Deployed/src/app/book-activity/[id]/page.tsx"],_="/book-activity/[id]/page",u={require:i,loadChunk:()=>Promise.resolve()},y=new a.AppPageRouteModule({definition:{kind:o.x.APP_PAGE,page:"/book-activity/[id]/page",pathname:"/book-activity/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},91721:(e,t,i)=>{Promise.resolve().then(i.bind(i,85823))},97273:(e,t,i)=>{"use strict";i.d(t,{default:()=>o.a});var a=i(53267),o=i.n(a)},53267:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});let a=i(39694);i(95344),i(3729);let o=a._(i(60546));function r(e,t){let i={loading:e=>{let{error:t,isLoading:i,pastDelay:a}=e;return null}};return"function"==typeof e&&(i.loader=e),(0,o.default)({...i,...t})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},38354:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return o}});let a=i(63689);function o(e){let{reason:t,children:i}=e;throw new a.BailoutToCSRError(t)}},60546:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return l}});let a=i(95344),o=i(3729),r=i(38354);function n(e){var t;return{default:null!=(t=null==e?void 0:e.default)?t:e}}let s={loader:()=>Promise.resolve(n(()=>null)),loading:null,ssr:!0},l=function(e){let t={...s,...e},i=(0,o.lazy)(()=>t.loader().then(n)),l=t.loading;function c(e){let n=l?(0,a.jsx)(l,{isLoading:!0,pastDelay:!0,error:null}):null,s=t.ssr?(0,a.jsx)(i,{...e}):(0,a.jsx)(r.BailoutToCSR,{reason:"next/dynamic",children:(0,a.jsx)(i,{...e})});return(0,a.jsx)(o.Suspense,{fallback:n,children:s})}return c.displayName="LoadableComponent",c}},85823:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>v});var a=i(95344),o=i(3729),r=i(8428),n=i(81012),s=i(87097),l=i(14408),c=i(49921),d=i(24763),_=i.n(d),u=i(25399),y=i(97273);i(86648);let p=(0,y.default)(async()=>{},{loadableGenerated:{modules:["../app/book-activity/[id]/page.tsx -> react-calendar"]},ssr:!1}),v=function(){let e=(0,r.useParams)(),t=(0,r.useRouter)(),[i,d]=(0,o.useState)(null),[y,v]=(0,o.useState)(!0),[m,g]=(0,o.useState)(null),[h,w]=(0,o.useState)(""),[k,x]=(0,o.useState)(null),[f,b]=(0,o.useState)(1),[j,A]=(0,o.useState)([]),[B,F]=(0,o.useState)([]),[N,S]=(0,o.useState)(null);(0,o.useEffect)(()=>{(async()=>{if(e?.id)try{let t=(0,s.JU)(n.db,"activities",e.id),i=await (0,s.QT)(t);if(i.exists()){let e=i.data();d({id:i.id,...e})}else g("Activity not found")}catch(e){console.error("Error fetching activity:",e),g("Error loading activity")}finally{v(!1)}})()},[e?.id]),(0,o.useEffect)(()=>{if(i){let e=[],t=new Date,a=new Set(i.closed_dates);for(let o=0;o<30;o++){let r=new Date(t);r.setDate(t.getDate()+o);let n=r.toISOString().split("T")[0],s=r.toLocaleDateString("en-US",{weekday:"long"}),l=i.weekly_schedule.find(e=>e.day===s);l?.is_open&&!a.has(n)&&e.push(n)}A(e)}},[i]),(0,o.useEffect)(()=>{if(i&&h){let e=new Date(h).toLocaleDateString("en-US",{weekday:"long"}),t=i.weekly_schedule.find(t=>t.day===e);t?.is_open?F(t.time_slots.filter(e=>e.available_capacity>0)):F([])}},[i,h]),j.map(e=>new Date(e));let P=e=>j.includes(e.toISOString().split("T")[0]),D=e=>{k&&e>0&&e<=k.available_capacity&&b(e)},q=e=>{let t=e.available_capacity/e.capacity*100;return t>50?{text:"Available",class:"available"}:t>0?{text:"Limited",class:"limited"}:{text:"Full",class:"full"}},C=async()=>{if(i&&h&&k)try{let e=(0,l.v0)().currentUser;if(!e){t.push("/login");return}v(!0);let a=(await (0,s.QT)((0,s.JU)(n.db,"Users",e.uid))).data(),o={activityId:i.id,userId:e.uid,name:a?.name||e.displayName||"Anonymous",email:a?.email||e.email||"",phone:a?.phone||"",selectedDate:h,selectedTimeSlot:k,tickets:f,totalAmount:i.price_per_slot*f};await (0,u.YN)({amount:i.price_per_slot*f,currency:"INR",receipt:`activity_${i.id}_${Date.now()}`,notes:{activityId:i.id,userId:e.uid}},o,"activity",e=>{t.push(`/booking-confirmation/${e}`)},e=>{console.error("Payment failed:",e),v(!1),t.push(`/payment-failed?activityId=${i.id}&error=${encodeURIComponent(e)}`)})}catch(e){console.error("Error initiating booking:",e),g("Error initiating booking. Please try again."),v(!1)}};return y?a.jsx("div",{className:_().bookingFlow,children:a.jsx("div",{className:_().loading,children:"Loading..."})}):m||!i?a.jsx("div",{className:_().bookingFlow,children:a.jsx("div",{className:_().error,children:m||"Activity not found"})}):a.jsx("div",{className:_().bookingFlow,children:(0,a.jsxs)("div",{className:_().container,children:[(0,a.jsxs)("div",{className:_().header,children:[a.jsx("h1",{className:_().activityName,children:i.name}),(0,a.jsxs)("p",{className:_().location,children:[a.jsx(c.Nh4,{})," ",i.location]})]}),a.jsx("h2",{className:_().sectionTitle,children:"Select Date & Time"}),a.jsx("div",{className:_().calendarContainer,children:a.jsx("div",{className:_().calendarWrapper,children:a.jsx(p,{onChange:e=>{e instanceof Date&&(S(e),w(e.toISOString().split("T")[0]),x(null))},value:N,tileDisabled:({date:e})=>!P(e),minDate:new Date,maxDate:new Date(Date.now()+2592e6),className:_().zestCalendar,tileClassName:({date:e,view:t})=>{if("month"===t){let t=new Date,i=e.toDateString()===t.toDateString(),a=N&&e.toDateString()===N.toDateString(),o=P(e),r=[];return i&&r.push(_().today),a&&r.push(_().selected),o||r.push(_().disabled),r.join(" ")}return""}})})}),N&&a.jsx("div",{className:_().selectedDateInfo,children:a.jsx("div",{className:_().selectedDateLabel,children:N.toLocaleDateString("en-GB",{day:"numeric",month:"long",year:"numeric",weekday:"long"})})}),N&&a.jsx("div",{className:_().slotsContainer,children:B.length>0?(0,a.jsxs)(a.Fragment,{children:[a.jsx("div",{className:_().slotsGrid,children:B.map((e,t)=>{let o=q(e);return(0,a.jsxs)("div",{className:`${_().timeSlot} ${k===e?_().selected:""}`,onClick:()=>x(e),children:[(0,a.jsxs)("div",{className:_().timeSlotHeader,children:[(0,a.jsxs)("div",{className:_().timeRange,children:[a.jsx(c.qyc,{className:_().timeIcon}),e.start_time," - ",e.end_time]}),a.jsx("div",{className:`${_().availabilityBadge} ${_()[o.class]}`,children:o.text})]}),(0,a.jsxs)("div",{className:_().timeSlotDetails,children:[(0,a.jsxs)("div",{className:_().capacity,children:[a.jsx(c.I$,{className:_().capacityIcon}),e.available_capacity,"/",e.capacity," spots available"]}),(0,a.jsxs)("div",{className:_().duration,children:["Duration: ",i.activity_duration]})]})]},t)})}),k&&(0,a.jsxs)("div",{className:_().ticketSection,children:[(0,a.jsxs)("div",{className:_().ticketQuantity,children:[a.jsx("label",{children:"Number of Tickets:"}),(0,a.jsxs)("div",{className:_().quantityControls,children:[a.jsx("button",{className:_().quantityButton,onClick:()=>D(f-1),disabled:f<=1,children:"-"}),a.jsx("span",{className:_().quantityValue,children:f}),a.jsx("button",{className:_().quantityButton,onClick:()=>D(f+1),disabled:f>=k.available_capacity,children:"+"})]})]}),(0,a.jsxs)("div",{className:_().totalAmount,children:["Total: ₹",(i.price_per_slot*f).toLocaleString()]}),a.jsx("button",{className:_().bookButton,onClick:C,disabled:y,children:y?"Processing Payment...":(0,a.jsxs)(a.Fragment,{children:[a.jsx(c.ypE,{}),(0,a.jsxs)("span",{children:["Pay ₹",(i.price_per_slot*f).toLocaleString()]})]})})]})]}):a.jsx("div",{className:_().noSlotsMessage,children:"No available time slots for this date."})}),m&&a.jsx("div",{className:_().error,children:m})]})})}},25399:(e,t,i)=>{"use strict";i.d(t,{YN:()=>n});let a=()=>new Promise(e=>{let t=document.createElement("script");t.src="https://checkout.razorpay.com/v1/checkout.js",t.onload=()=>e(!0),t.onerror=()=>e(!1),document.body.appendChild(t)}),o=async e=>{try{let t=await fetch("/api/payment/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),i=await t.json();if(!t.ok)throw Error(i.error||"Failed to create order");return i.order}catch(e){throw console.error("Error creating Razorpay order:",e),e}},r=async(e,t,i)=>{try{let a=await fetch("/api/payment/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({razorpay_order_id:e.razorpay_order_id,razorpay_payment_id:e.razorpay_payment_id,razorpay_signature:e.razorpay_signature,bookingData:t,bookingType:i})}),o=await a.json();if(!a.ok)throw Error(o.error||"Payment verification failed");return o}catch(e){throw console.error("Error verifying payment:",e),e}},n=async(e,t,i,n,s)=>{try{if(!await a())throw Error("Failed to load Razorpay script");let l=await o(e),c={key:process.env.NEXT_PUBLIC_RAZORPAY_KEY_ID,amount:l.amount,currency:l.currency,name:"Zest",description:"event"===i?"Event Booking":"Activity Booking",order_id:l.id,handler:async e=>{try{let a=await r(e,t,i);n(a.bookingId)}catch(e){console.error("Payment verification failed:",e),s(e instanceof Error?e.message:"Payment verification failed")}},prefill:{name:t.name,email:t.email,contact:t.phone},theme:{color:"#c084fc"},modal:{ondismiss:()=>{s("Payment cancelled by user")}}};new window.Razorpay(c).open()}catch(e){console.error("Error initiating payment:",e),s(e instanceof Error?e.message:"Failed to initiate payment")}}},24763:e=>{e.exports={bookingFlow:"ActivityBookingFlow_bookingFlow__Q4Bqa",container:"ActivityBookingFlow_container__rTMSD",header:"ActivityBookingFlow_header__C7H8_",activityName:"ActivityBookingFlow_activityName__QTjVM",location:"ActivityBookingFlow_location__UcTIZ",sectionTitle:"ActivityBookingFlow_sectionTitle__RSiCZ",calendarContainer:"ActivityBookingFlow_calendarContainer__W0x8X",calendarWrapper:"ActivityBookingFlow_calendarWrapper___wxPV",zestCalendar:"ActivityBookingFlow_zestCalendar__rlNJs","react-calendar__navigation":"ActivityBookingFlow_react-calendar__navigation__cuEAl","react-calendar__navigation__label":"ActivityBookingFlow_react-calendar__navigation__label___6pBF","react-calendar__month-view__weekdays":"ActivityBookingFlow_react-calendar__month-view__weekdays__pl9lX","react-calendar__month-view__weekdays__weekday":"ActivityBookingFlow_react-calendar__month-view__weekdays__weekday__I3qcP","react-calendar__month-view__days":"ActivityBookingFlow_react-calendar__month-view__days__6Zhiz","react-calendar__tile":"ActivityBookingFlow_react-calendar__tile__KgkET","react-calendar__tile--disabled":"ActivityBookingFlow_react-calendar__tile--disabled__AbCnc","react-calendar__tile--active":"ActivityBookingFlow_react-calendar__tile--active__TJ1lr","react-calendar__tile--hasActive":"ActivityBookingFlow_react-calendar__tile--hasActive__INO37","react-calendar__tile--now":"ActivityBookingFlow_react-calendar__tile--now__HFhzg","react-calendar__month-view__days__day--neighboringMonth":"ActivityBookingFlow_react-calendar__month-view__days__day--neighboringMonth__VHwNa","react-calendar__month-view__days__day--weekend":"ActivityBookingFlow_react-calendar__month-view__days__day--weekend__eFe6c","react-calendar__month-view__days__day":"ActivityBookingFlow_react-calendar__month-view__days__day__2c9MO","react-calendar__month-view__days__day--disabled":"ActivityBookingFlow_react-calendar__month-view__days__day--disabled__KQnWH",selectedDateInfo:"ActivityBookingFlow_selectedDateInfo__sZZJt",fadeInUp:"ActivityBookingFlow_fadeInUp__7J59z",selectedDateLabel:"ActivityBookingFlow_selectedDateLabel__NDXYM",slotsContainer:"ActivityBookingFlow_slotsContainer__VjEnu",slotsGrid:"ActivityBookingFlow_slotsGrid__r2I7y",timeSlot:"ActivityBookingFlow_timeSlot__XCo_U",selected:"ActivityBookingFlow_selected__1aPt6",timeSlotHeader:"ActivityBookingFlow_timeSlotHeader__CWsVS",timeRange:"ActivityBookingFlow_timeRange__5MNge",timeIcon:"ActivityBookingFlow_timeIcon__ku_0B",availabilityBadge:"ActivityBookingFlow_availabilityBadge__7hxAZ",available:"ActivityBookingFlow_available___3lrX",limited:"ActivityBookingFlow_limited__vrCWm",full:"ActivityBookingFlow_full__6nhcP",timeSlotDetails:"ActivityBookingFlow_timeSlotDetails__Ey4jN",capacity:"ActivityBookingFlow_capacity__EHtC0",capacityIcon:"ActivityBookingFlow_capacityIcon__jZc76",duration:"ActivityBookingFlow_duration__fQVkw",ticketSection:"ActivityBookingFlow_ticketSection__07v4q",ticketQuantity:"ActivityBookingFlow_ticketQuantity__e7F2c",quantityControls:"ActivityBookingFlow_quantityControls__APd9Z",quantityButton:"ActivityBookingFlow_quantityButton__hsxKB",quantityValue:"ActivityBookingFlow_quantityValue___H8Yl",totalAmount:"ActivityBookingFlow_totalAmount__JUReX",bookButton:"ActivityBookingFlow_bookButton__USCvf",noSlotsMessage:"ActivityBookingFlow_noSlotsMessage__6Dy2K",loading:"ActivityBookingFlow_loading__gVM_h",error:"ActivityBookingFlow_error__sfMrM"}},29127:(e,t,i)=>{"use strict";i.r(t),i.d(t,{$$typeof:()=>r,__esModule:()=>o,default:()=>n});let a=(0,i(86843).createProxy)(String.raw`/Users/shreyasgurav/Documents/Projects/Zest Deployed/src/app/book-activity/[id]/page.tsx`),{__esModule:o,$$typeof:r}=a,n=a.default},86648:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),a=t.X(0,[1638,4292,4684],()=>i(80639));module.exports=a})();
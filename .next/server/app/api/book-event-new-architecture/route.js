"use strict";(()=>{var e={};e.id=2271,e.ids=[2271],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},82361:e=>{e.exports=require("events")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},85158:e=>{e.exports=require("http2")},41808:e=>{e.exports=require("net")},22037:e=>{e.exports=require("os")},71017:e=>{e.exports=require("path")},77282:e=>{e.exports=require("process")},12781:e=>{e.exports=require("stream")},24404:e=>{e.exports=require("tls")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},75948:(e,t,s)=>{s.r(t),s.d(t,{headerHooks:()=>k,originalPathname:()=>I,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>v});var r={};s.r(r),s.d(r,{POST:()=>l});var n=s(95419),i=s(69108),a=s(99678),o=s(78070),u=s(77483),c=s(4229);let d=async e=>await (0,c.i3)(u.db,async t=>{let s=(0,c.JU)(u.db,"events",e.eventId),r=await t.get(s);if(!r.exists())throw Error("Event not found");let n=r.data(),i=n.sessions?.find(t=>t.sessionId===e.sessionId);if(!i)throw Error(`Session ${e.sessionId} not found`);for(let t of e.ticketSelections){let e=i.tickets.find(e=>e.name===t.ticketName);if(!e)throw Error(`Ticket type "${t.ticketName}" not found in session`);if(e.available_capacity<t.quantity)throw Error(`Only ${e.available_capacity} tickets available for ${t.ticketName}`)}let a=[],o=e.ticketSelections.reduce((e,t)=>e+t.quantity,0);for(let s of e.ticketSelections)for(let r=0;r<s.quantity;r++){let r=(0,c.JU)((0,c.hJ)(u.db,"eventAttendees")),o={eventId:e.eventId,sessionId:e.sessionId,name:e.attendeeInfo.name,email:e.attendeeInfo.email,phone:e.attendeeInfo.phone,userId:e.userId,eventTitle:n.title,sessionTitle:i.title,sessionStartTime:i.start_time,sessionEndTime:i.end_time,ticketType:s.ticketName,venue:n.event_venue,individualAmount:s.unitPrice,paymentId:e.paymentData.paymentId,paymentStatus:"completed",checkedIn:!1,canCheckInIndependently:!0,status:"confirmed",createdAt:(0,c.Bt)(),updatedAt:(0,c.Bt)()};t.set(r,o),a.push(r.id)}let d=n.sessions.map(t=>{if(t.sessionId===e.sessionId){let s=t.tickets.map(t=>{let s=e.ticketSelections.find(e=>e.ticketName===t.name);return s?{...t,available_capacity:t.available_capacity-s.quantity}:t});return{...t,tickets:s}}return t});return t.update(s,{sessions:d,updatedAt:(0,c.Bt)()}),{attendeeIds:a,totalTickets:o,sessionId:e.sessionId}});async function l(e){try{let{eventId:t,sessionId:s,userId:r,userInfo:n,selectedTickets:i,totalAmount:a}=await e.json();if(!t||!s||!r||!n||!i||!a)return o.Z.json({success:!1,error:"Missing required fields"},{status:400});if(!n.name?.trim()||!n.email?.trim()||!n.phone?.trim())return o.Z.json({success:!1,error:"Complete user information is required"},{status:400});if(0===Object.keys(i).length)return o.Z.json({success:!1,error:"At least one ticket must be selected"},{status:400});console.log("\uD83C\uDFAF Creating booking with new architecture:",{eventId:t,sessionId:s,userId:r,ticketsCount:Object.keys(i).length,totalAmount:a});let u=Object.entries(i).map(([e,t])=>({ticketName:e,quantity:Number(t),unitPrice:a/Object.values(i).reduce((e,t)=>e+Number(t),0)})),c={eventId:t,sessionId:s,userId:r,attendeeInfo:{name:n.name.trim(),email:n.email.trim(),phone:n.phone.trim()},ticketSelections:u,paymentData:{paymentId:`temp_${Date.now()}`,totalAmount:a}},l=await d(c);return console.log("âœ… Booking created successfully:",l.attendeeIds?.length,"attendees"),o.Z.json({success:!0,message:"Booking created successfully",data:{attendeeIds:l.attendeeIds,totalTickets:l.totalTickets,sessionId:l.sessionId}})}catch(e){return console.error("\uD83D\uDCA5 API Error in book-event-new-architecture:",e),o.Z.json({success:!1,error:e instanceof Error?e.message:"Internal server error"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/book-event-new-architecture/route",pathname:"/api/book-event-new-architecture",filename:"route",bundlePath:"app/api/book-event-new-architecture/route"},resolvedPagePath:"/Users/shreyasgurav/Documents/Projects/Zest Deployed/src/app/api/book-event-new-architecture/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:f,headerHooks:k,staticGenerationBailout:v}=p,I="/api/book-event-new-architecture/route";function y(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:h})}},77483:(e,t,s)=>{s.d(t,{db:()=>u});var r=s(77010),n=s(70538),i=s(4229),a=s(84749);let o=0===(0,r.C6)().length?(0,r.ZF)({apiKey:"AIzaSyB7Er7lujXysZ_3J2seIoas3lAX1PAZRKE",authDomain:"zest-62191.firebaseapp.com",projectId:"zest-62191",storageBucket:"zest-62191.appspot.com",messagingSenderId:"475534986851",appId:"1:475534986851:web:49a11fe3f50b7ee7237256",measurementId:"G-XSS8QEY3PX"}):(0,r.C6)()[0];console.log("App Check disabled to prevent phone auth conflicts"),(0,n.v0)(o);let u=(0,i.ad)(o);(0,a.cF)(o)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[1638,6206,9369],()=>s(75948));module.exports=r})();
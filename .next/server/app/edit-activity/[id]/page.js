(()=>{var e={};e.id=8960,e.ids=[8960],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6113:e=>{"use strict";e.exports=require("crypto")},9523:e=>{"use strict";e.exports=require("dns")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},85158:e=>{"use strict";e.exports=require("http2")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},41956:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GlobalError:()=>c.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>v,tree:()=>o});var s=i(50482),a=i(69108),r=i(62563),c=i.n(r),n=i(68300),l={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>n[e]);i.d(t,l);let o=["",{children:["edit-activity",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(i.bind(i,63915)),"/Users/shreyasgurav/Documents/Projects/Zest Deployed/src/app/edit-activity/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(i.bind(i,39258)),"/Users/shreyasgurav/Documents/Projects/Zest Deployed/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(i.t.bind(i,69361,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/shreyasgurav/Documents/Projects/Zest Deployed/src/app/edit-activity/[id]/page.tsx"],u="/edit-activity/[id]/page",m={require:i,loadChunk:()=>Promise.resolve()},v=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/edit-activity/[id]/page",pathname:"/edit-activity/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},77465:(e,t,i)=>{Promise.resolve().then(i.bind(i,68493))},68493:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>m});var s=i(95344),a=i(3729),r=i(8428),c=i(81012),n=i(87097),l=i(73424),o=i(14408),d=i(21871),u=i.n(d);let m=()=>{let e=(0,r.useRouter)(),t=(0,r.useParams)(),i=t?.id,d=(0,o.v0)(),[m,v]=(0,a.useState)(""),[p,y]=(0,a.useState)(""),[h,_]=(0,a.useState)(""),[g,x]=(0,a.useState)(!0),[j,f]=(0,a.useState)(!1),[S,A]=(0,a.useState)(""),[b,N]=(0,a.useState)(""),[E,q]=(0,a.useState)(""),[C,w]=(0,a.useState)(null),[P,D]=(0,a.useState)(null),[k,B]=(0,a.useState)(null),[U,G]=(0,a.useState)(""),[I,T]=(0,a.useState)(""),[L,O]=(0,a.useState)(""),[R,$]=(0,a.useState)(""),[M,z]=(0,a.useState)({}),[H,J]=(0,a.useState)([]),[F,V]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(!i||!d.currentUser){e.push("/");return}Y()},[i,d.currentUser]);let Y=async()=>{if(i&&d.currentUser)try{let e=await (0,n.QT)((0,n.JU)(c.db,"activities",i));if(!e.exists()){A("Activity not found");return}let t=e.data();if(t.organizationId!==d.currentUser.uid){A("You are not authorized to edit this activity");return}V(!0),v(t.activity_name||""),y(t.activity_venue||""),_(t.about_activity||""),G(t.activity_category||""),T(t.activity_languages||""),O(t.activity_duration||""),$(t.activity_age_limit||""),N(t.hosting_club||""),q(t.organization_username||""),t.activity_image&&(B(t.activity_image),D(t.activity_image)),t.weekly_schedule&&z(t.weekly_schedule),t.closed_dates&&J(t.closed_dates)}catch(e){console.error("Error fetching activity data:",e),A("Failed to load activity data")}finally{x(!1)}},Z=(e,t,i)=>{z(s=>({...s,[e]:{...s[e],[t]:i}}))},W=e=>{z(t=>({...t,[e]:{...t[e],timeSlots:[...t[e].timeSlots,{start_time:"",end_time:"",capacity:0,available_capacity:0}]}}))},X=(e,t)=>{z(i=>({...i,[e]:{...i[e],timeSlots:i[e].timeSlots.filter((e,i)=>i!==t)}}))},K=(e,t,i,s)=>{z(a=>({...a,[e]:{...a[e],timeSlots:a[e].timeSlots.map((e,a)=>a===t?{...e,[i]:s}:e)}}))},Q=e=>{H.includes(e)||J([...H,e])},ee=e=>{J(H.filter(t=>t!==e))},et=async e=>{if(!e)return null;try{if(k)try{let e=(0,l.iH)(c.tO,k);await (0,l.oq)(e)}catch(e){console.error("Error deleting old image:",e)}let t=e.name.split(".").pop(),i=`activities/${Date.now()}-${Math.random().toString(36).substring(7)}.${t}`,s=(0,l.iH)(c.tO,i),a={contentType:e.type,customMetadata:{uploadedBy:d.currentUser?.uid||"unknown",uploadTime:new Date().toISOString()}},r=await (0,l.KV)(s,e,a);return await (0,l.Jt)(r.ref)}catch(e){throw console.error("Error in uploadImage:",e),Error(`Image upload failed: ${e.message}`)}},ei=()=>Object.entries(M).every(([e,t])=>!t.isOpen||t.timeSlots.every(e=>e.start_time&&e.end_time&&e.capacity>0&&new Date(`2000-01-01 ${e.end_time}`)>new Date(`2000-01-01 ${e.start_time}`))),es=async t=>{if(t.preventDefault(),!d.currentUser||!i){A("Please sign in to edit the activity");return}if(!m.trim()||!p.trim()||!ei()){A("Please fill in all required fields and ensure valid schedule");return}f(!0),A("");try{let t=k,s=!1,a="";if(C)try{t=await et(C)}catch(e){console.error("Image upload failed:",e),s=!0,a=e.message}let r=(0,n.hJ)(c.db,"activity_bookings"),l=(0,n.IO)(r,(0,n.ar)("activityId","==",i));(await (0,n.PL)(l)).empty;let o={activity_name:m.trim(),weekly_schedule:M,closed_dates:H,activity_venue:p.trim(),about_activity:h.trim(),activity_image:t,activity_category:U.trim(),activity_languages:I.trim(),activity_duration:L.trim(),activity_age_limit:R.trim(),updatedAt:(0,n.Bt)(),image_upload_status:s?"failed":t?"success":"none"};await (0,n.r7)((0,n.JU)(c.db,"activities",i),o),s?A(`Activity updated successfully! Note: ${a} You can try uploading the image again later.`):A("Activity updated successfully!"),setTimeout(()=>{e.push(`/activity-dashboard/${i}`),e.refresh()},2e3)}catch(e){console.error("Error updating activity:",e),A(`Failed to update activity: ${e.message}`)}finally{f(!1)}};return g?s.jsx("div",{className:u().editActivityPage,children:s.jsx("div",{className:u().editActivityContainer,children:s.jsx("div",{className:u().loadingState,children:"Loading activity data..."})})}):F?s.jsx("div",{className:u().editActivityPage,children:(0,s.jsxs)("div",{className:u().editActivityContainer,children:[s.jsx("h1",{className:u().pageTitle,children:"Edit Activity"}),(0,s.jsxs)("form",{onSubmit:es,className:u().editActivityForm,children:[(0,s.jsxs)("div",{className:u().formSection,children:[s.jsx("h2",{children:"Activity Image"}),s.jsx("p",{className:u().imageTip,children:"Please upload a square image for best results (max 5MB)"}),s.jsx("input",{type:"file",accept:"image/*",onChange:e=>{let t=e.target.files?.[0];if(t){if(t.size>5242880){A("Image size should be less than 5MB");return}w(t),D(URL.createObjectURL(t))}},className:u().fileInput}),P&&s.jsx("div",{className:u().imagePreview,children:s.jsx("img",{src:P,alt:"Preview"})})]}),(0,s.jsxs)("div",{className:u().formSection,children:[s.jsx("h2",{children:"Activity Details"}),(0,s.jsxs)("div",{className:u().formGroup,children:[s.jsx("label",{children:"Activity Name"}),s.jsx("input",{type:"text",value:m,onChange:e=>v(e.target.value),placeholder:"Enter activity name",required:!0})]}),(0,s.jsxs)("div",{className:u().formGroup,children:[s.jsx("label",{children:"Activity Category"}),s.jsx("input",{type:"text",value:U,onChange:e=>G(e.target.value),placeholder:"e.g., Sports, Arts, Adventure",required:!0})]})]}),(0,s.jsxs)("div",{className:u().formSection,children:[s.jsx("h2",{children:"Weekly Schedule"}),Object.entries(M).map(([e,t])=>(0,s.jsxs)("div",{className:u().daySchedule,children:[(0,s.jsxs)("div",{className:u().dayHeader,children:[s.jsx("h3",{children:e}),(0,s.jsxs)("label",{className:u().toggleSwitch,children:[s.jsx("input",{type:"checkbox",checked:t.isOpen,onChange:t=>Z(e,"isOpen",t.target.checked)}),s.jsx("span",{className:u().slider}),s.jsx("span",{className:u().toggleLabel,children:t.isOpen?"Open":"Closed"})]})]}),t.isOpen&&(0,s.jsxs)("div",{className:u().timeSlotsContainer,children:[t.timeSlots.map((i,a)=>s.jsx("div",{className:u().timeSlot,children:(0,s.jsxs)("div",{className:u().formRow,children:[(0,s.jsxs)("div",{className:u().formGroup,children:[s.jsx("label",{children:"Start Time"}),s.jsx("input",{type:"time",value:i.start_time,onChange:t=>K(e,a,"start_time",t.target.value),required:!0})]}),(0,s.jsxs)("div",{className:u().formGroup,children:[s.jsx("label",{children:"End Time"}),s.jsx("input",{type:"time",value:i.end_time,onChange:t=>K(e,a,"end_time",t.target.value),required:!0})]}),(0,s.jsxs)("div",{className:u().formGroup,children:[s.jsx("label",{children:"Capacity"}),s.jsx("input",{type:"number",value:i.capacity,onChange:t=>K(e,a,"capacity",parseInt(t.target.value)),min:"1",required:!0})]}),t.timeSlots.length>1&&s.jsx("button",{type:"button",className:u().removeSlotButton,onClick:()=>X(e,a),children:"Remove"})]})},a)),s.jsx("button",{type:"button",className:u().addSlotButton,onClick:()=>W(e),children:"Add Time Slot"})]})]},e))]}),(0,s.jsxs)("div",{className:u().formSection,children:[s.jsx("h2",{children:"Closed Dates"}),(0,s.jsxs)("div",{className:u().formGroup,children:[s.jsx("label",{children:"Add Closed Date"}),s.jsx("input",{type:"date",onChange:e=>Q(e.target.value),min:new Date().toISOString().split("T")[0]})]}),s.jsx("div",{className:u().closedDatesList,children:H.map(e=>(0,s.jsxs)("div",{className:u().closedDateItem,children:[s.jsx("span",{children:new Date(e).toLocaleDateString()}),s.jsx("button",{type:"button",className:u().removeDateButton,onClick:()=>ee(e),children:"Remove"})]},e))})]}),(0,s.jsxs)("div",{className:u().formSection,children:[s.jsx("h2",{children:"Location"}),(0,s.jsxs)("div",{className:u().formGroup,children:[s.jsx("label",{children:"Venue"}),s.jsx("input",{type:"text",value:p,onChange:e=>y(e.target.value),placeholder:"Enter activity venue",required:!0})]})]}),(0,s.jsxs)("div",{className:u().formSection,children:[s.jsx("h2",{children:"About Activity"}),s.jsx("div",{className:u().formGroup,children:s.jsx("textarea",{value:h,onChange:e=>_(e.target.value),placeholder:"Enter activity description",rows:4,required:!0})})]}),(0,s.jsxs)("div",{className:u().formSection,children:[s.jsx("h2",{children:"Activity Guide"}),(0,s.jsxs)("div",{className:u().formRow,children:[(0,s.jsxs)("div",{className:u().formGroup,children:[s.jsx("label",{children:"Duration"}),s.jsx("input",{type:"text",value:L,onChange:e=>O(e.target.value),placeholder:"e.g., 2 Hours",required:!0})]}),(0,s.jsxs)("div",{className:u().formGroup,children:[s.jsx("label",{children:"Age Requirement"}),s.jsx("input",{type:"text",value:R,onChange:e=>$(e.target.value),placeholder:"e.g., 16+ years",required:!0})]}),(0,s.jsxs)("div",{className:u().formGroup,children:[s.jsx("label",{children:"Activity Languages"}),s.jsx("input",{type:"text",value:I,onChange:e=>T(e.target.value),placeholder:"e.g., English, Hindi",required:!0})]})]})]}),S&&s.jsx("div",{className:`${u().message} ${S.includes("success")?u().success:u().error}`,children:S}),(0,s.jsxs)("div",{className:u().formActions,children:[s.jsx("button",{type:"submit",className:u().submitButton,disabled:j,children:j?"Saving Changes...":"Save Changes"}),s.jsx("button",{type:"button",className:u().cancelButton,onClick:()=>e.push(`/activity-dashboard/${i}`),disabled:j,children:"Cancel"})]})]})]})}):s.jsx("div",{className:u().editActivityPage,children:s.jsx("div",{className:u().editActivityContainer,children:(0,s.jsxs)("div",{className:u().unauthorizedMessage,children:[s.jsx("h1",{children:"Unauthorized"}),s.jsx("p",{children:S||"You are not authorized to edit this activity."}),s.jsx("button",{className:u().backButton,onClick:()=>e.push("/"),children:"Back to Home"})]})})})}},21871:e=>{e.exports={editActivityPage:"EditActivity_editActivityPage__J_J0X",editActivityContainer:"EditActivity_editActivityContainer__8Juw6",pageTitle:"EditActivity_pageTitle__1RigP",editActivityForm:"EditActivity_editActivityForm__FcMUf",formGrid:"EditActivity_formGrid__gk_TI",formSection:"EditActivity_formSection__j82Wn",formGroup:"EditActivity_formGroup__t23ae",imageSection:"EditActivity_imageSection__1nhpR",imageTip:"EditActivity_imageTip__xY_Ut",fileInput:"EditActivity_fileInput__rSTUW",imagePreview:"EditActivity_imagePreview__ZL1N4",formRow:"EditActivity_formRow__Lj91e",daySchedule:"EditActivity_daySchedule__KUV1b",dayHeader:"EditActivity_dayHeader__FeFlq",toggleSwitch:"EditActivity_toggleSwitch__Ec8__",slider:"EditActivity_slider__YUOa7",toggleLabel:"EditActivity_toggleLabel__XsYue",timeSlotsContainer:"EditActivity_timeSlotsContainer__qqSTH",timeSlot:"EditActivity_timeSlot__692ck",addSlotButton:"EditActivity_addSlotButton___bZNn",removeSlotButton:"EditActivity_removeSlotButton__2C4A0",closedDatesList:"EditActivity_closedDatesList__LVViK",closedDateItem:"EditActivity_closedDateItem__pIBuN",removeDateButton:"EditActivity_removeDateButton__SUC4k",formActions:"EditActivity_formActions__4grWi",submitButton:"EditActivity_submitButton__dNtL3",cancelButton:"EditActivity_cancelButton__6JlOn",message:"EditActivity_message__eeN_s",success:"EditActivity_success__JMH4a",error:"EditActivity_error__N9S8V",loadingState:"EditActivity_loadingState__HkRoR",unauthorizedMessage:"EditActivity_unauthorizedMessage__XuA4n",backButton:"EditActivity_backButton__gy7Ic"}},63915:(e,t,i)=>{"use strict";i.r(t),i.d(t,{$$typeof:()=>r,__esModule:()=>a,default:()=>c});let s=(0,i(86843).createProxy)(String.raw`/Users/shreyasgurav/Documents/Projects/Zest Deployed/src/app/edit-activity/[id]/page.tsx`),{__esModule:a,$$typeof:r}=s,c=s.default}};var t=require("../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),s=t.X(0,[1638,4292,4684],()=>i(41956));module.exports=s})();